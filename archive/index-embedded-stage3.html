<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PSPF Explorer - Interactive Compliance Framework compliance tracking and management tool">
    <meta name="author" content="PSPF Explorer">
    <meta name="robots" content="noindex, nofollow">
    <title>PSPF Explorer</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
</head>
<body>
    <!-- Welcome Modal for First-Time Users -->
    <div id="welcomeModal" class="modal">
        <div class="modal-content">
            <h2>Welcome to PSPF Explorer</h2>
            <p>Transform your compliance framework from static documents into an engaging, interactive experience!</p>
            
            <div class="welcome-steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>Watch the Heartbeat</h3>
                        <p>Each domain has a heartbeat pulse that shows its health. Unhealthy pulses indicate areas needing attention.</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>Mark Requirements as Met</h3>
                        <p>Click domains to see requirements. Mark them as "Yes" when complete. Add detailed comments for "No" items to improve the pulse.</p>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>Manage Your Work</h3>
                        <p>Add projects, tasks, and track activities. The more you document and complete, the healthier your domains become!</p>
                    </div>
                </div>
            </div>
            
            <div class="pulse-demo">
                <div class="pulse-example healthy">
                    <div class="pulse-dot"></div>
                    <span>Healthy: All requirements met</span>
                </div>
                <div class="pulse-example warning">
                    <div class="pulse-dot"></div>
                    <span>Warning: Some requirements not met with good explanations</span>
                </div>
                <div class="pulse-example critical">
                    <div class="pulse-dot"></div>
                    <span>Critical: Requirements not met with poor or no explanations</span>
                </div>
            </div>
            
            <button id="closeWelcome" class="btn btn-primary">Start Exploring</button>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1 class="logo">PSPF Explorer</h1>
            <nav class="nav">
                <button id="homeBtn" class="nav-btn active">Home</button>
                <button id="searchBtn" class="nav-btn">Search</button>
                <button id="progressBtn" class="nav-btn">Progress</button>
                <button id="projectBtn" class="nav-btn">Projects</button>
                <button id="dataBtn" class="nav-btn">Data</button>
                <button id="helpBtn" class="nav-btn">Help</button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Breadcrumb Navigation -->
            <nav class="breadcrumb" id="breadcrumb">
                <a href="#" data-level="home">PSPF Domains</a>
            </nav>

            <!-- Home View - Domain Overview -->
            <section id="homeView" class="view active">
                <div class="view-header">
                    <h2>Compliance Framework 2025</h2>
                    <p class="subtitle">Watch the heartbeat of your compliance status. Healthy pulses mean strong protection.</p>
                </div>

                <div class="domains-grid" id="domainsGrid">
                    <!-- Domain cards will be dynamically generated -->
                </div>

                <!-- Requirements Section (initially hidden) -->
                <div class="requirements-section hidden" id="requirementsSection">
                    <div class="requirements-header">
                        <h3 id="selectedDomainTitle">Domain Requirements</h3>
                        <p id="selectedDomainDescription">Select a domain above to view its requirements</p>
                    </div>
                    <div class="requirements-grid" id="requirementsGrid">
                        <!-- Requirements will be dynamically generated -->
                    </div>
                </div>

                <div class="stats-overview" id="statsOverview">
                    <div class="stat-card">
                        <span class="stat-number" id="totalProjects">0</span>
                        <span class="stat-label">Active Projects</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="totalTasks">0</span>
                        <span class="stat-label">Total Tasks</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="completedTasks">0</span>
                        <span class="stat-label">Completed Tasks</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="overallCompliance">0%</span>
                        <span class="stat-label">Requirements Met</span>
                    </div>
                </div>
            </section>

            <!-- Search View -->
            <section id="searchView" class="view">
                <div class="view-header">
                    <h2>Search</h2>
                    <div class="search-bar">
                        <input type="text" id="searchInput" placeholder="Search projects, tasks, activities, or events...">
                        <button id="searchSubmit" class="btn btn-primary">Search</button>
                    </div>
                </div>
                <div class="search-results" id="searchResults">
                    <!-- Search results will be displayed here -->
                </div>
            </section>

            <!-- Progress View -->
            <section id="progressView" class="view">
                <div class="view-header">
                    <h2>Progress Overview</h2>
                    <p class="subtitle">Track your compliance journey across all domains</p>
                </div>
                <div class="progress-grid" id="progressGrid">
                    <!-- Progress cards will be dynamically generated -->
                </div>
            </section>

            <!-- Data Management View -->
            <section id="dataView" class="view">
                <div class="view-header">
                    <h2>Data Management</h2>
                    <p class="subtitle">Export, import, and manage your PSPF Explorer data</p>
                </div>
                
                <div class="data-management">
                    <div class="data-section">
                        <div class="data-card">
                            <h3>üóÇÔ∏è Export Data</h3>
                            <p>Download all your projects, tasks, activities, and events as a backup file.</p>
                            <button id="exportDataBtn" class="btn btn-primary">Export All Data</button>
                        </div>
                        
                        <div class="data-card">
                            <h3>üì• Import Data</h3>
                            <p>Restore data from a previously exported backup file.</p>
                            <input type="file" id="importFileInput" accept=".json" class="hidden" title="Select backup file to import">
                            <button id="importDataBtn" class="btn btn-secondary">Import Data</button>
                        </div>
                        
                        <div class="data-card warning">
                            <h3>üóëÔ∏è Clear Data</h3>
                            <p>Remove all data and start fresh. This action cannot be undone.</p>
                            <button id="clearDataBtn" class="btn btn-danger">Clear All Data</button>
                        </div>
                    </div>
                    
                    <div class="data-info">
                        <h3>üìä Data Summary</h3>
                        <div class="data-stats">
                            <div class="stat-item">
                                <span class="stat-label">Projects:</span>
                                <span class="stat-value" id="dataProjectCount">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Tasks:</span>
                                <span class="stat-value" id="dataTaskCount">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Activities:</span>
                                <span class="stat-value" id="dataRiskCount">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Events:</span>
                                <span class="stat-value" id="dataIncidentCount">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Last Modified:</span>
                                <span class="stat-value" id="dataLastModified">Never</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Project Management View -->
            <section id="projectView" class="view">
                <div class="view-header">
                    <h2>Project Management</h2>
                    <p class="subtitle">Manage your compliance projects and activities</p>
                    <button id="addProjectBtn" class="btn btn-primary">Add Project</button>
                </div>
                <div class="projects-list" id="projectsList">
                    <!-- Projects will be dynamically generated -->
                </div>
            </section>

            <!-- Help View -->
            <section id="helpView" class="view">
                <div class="view-header">
                    <h2>Help & Support</h2>
                    <p class="subtitle">Learn how to use PSPF Explorer effectively</p>
                </div>
                <div class="help-content">
                    <h3>Getting Started</h3>
                    <p>PSPF Explorer helps you track compliance across multiple domains. Start by exploring the domains on the Home tab.</p>
                    
                    <h3>Managing Projects</h3>
                    <p>Create projects to organize your compliance work. Each project can have multiple tasks, activities, and events.</p>
                    
                    <h3>Progress Tracking</h3>
                    <p>Use the Progress tab to see your overall compliance status across all domains.</p>
                </div>
            </section>
        </div>
    </main>

    <!-- CRUD Modals -->
    <!-- Project Modal -->
    <div id="projectModal" class="modal">
        <div class="modal-content">
            <h3 id="projectModalTitle">Add Project</h3>
            <form id="projectForm">
                <div class="form-group">
                    <label for="projectName">Project Name</label>
                    <input type="text" id="projectName" required>
                </div>
                <div class="form-group">
                    <label for="projectDesc">Description</label>
                    <textarea id="projectDesc" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="projectStatusSelect">Status</label>
                    <select id="projectStatusSelect">
                        <option value="planning">Planning</option>
                        <option value="active">Active</option>
                        <option value="on-hold">On Hold</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="projectStartDate">Start Date</label>
                    <input type="date" id="projectStartDate">
                </div>
                <div class="form-group">
                    <label for="projectEndDate">Target End Date</label>
                    <input type="date" id="projectEndDate">
                </div>
                <div class="form-group">
                    <label for="projectUrl">Project URL</label>
                    <input type="url" id="projectUrl" placeholder="https://example.com">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelProject">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Project</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Task Modal -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <h3 id="taskModalTitle">Add Task</h3>
            <form id="taskForm">
                <div class="form-group">
                    <label for="taskName">Task Name</label>
                    <input type="text" id="taskName" required>
                </div>
                <div class="form-group">
                    <label for="taskDesc">Description</label>
                    <textarea id="taskDesc" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="taskStatus">Status</label>
                    <select id="taskStatus">
                        <option value="not-started">Not Started</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                        <option value="blocked">Blocked</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="taskAssignee">Assignee</label>
                    <input type="text" id="taskAssignee">
                </div>
                <div class="form-group">
                    <label for="taskDueDate">Due Date</label>
                    <input type="date" id="taskDueDate">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelTask">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Task</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Activity Modal -->
    <div id="riskModal" class="modal">
        <div class="modal-content">
            <h3 id="riskModalTitle">Add Activity</h3>
            <form id="riskForm">
                <div class="form-group">
                    <label for="riskName">Activity Title</label>
                    <input type="text" id="riskName" required>
                </div>
                <div class="form-group">
                    <label for="riskDesc">Description</label>
                    <textarea id="riskDesc" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="riskLikelihood">Priority</label>
                    <select id="riskLikelihood">
                        <option value="very-low">Very Low</option>
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                        <option value="very-high">Very High</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="riskImpact">Impact</label>
                    <select id="riskImpact">
                        <option value="very-low">Very Low</option>
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                        <option value="very-high">Very High</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="riskMitigation">Action Plan</label>
                    <textarea id="riskMitigation" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelRisk">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Activity</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Event Modal -->
    <div id="incidentModal" class="modal">
        <div class="modal-content">
            <h3 id="incidentModalTitle">Add Event</h3>
            <form id="incidentForm">
                <div class="form-group">
                    <label for="incidentName">Event Title</label>
                    <input type="text" id="incidentName" required>
                </div>
                <div class="form-group">
                    <label for="incidentDesc">Description</label>
                    <textarea id="incidentDesc" rows="4"></textarea>
                </div>
                <div class="form-group">
                    <label for="incidentDate">Date Occurred</label>
                    <input type="datetime-local" id="incidentDate" required>
                </div>
                <div class="form-group">
                    <label for="incidentSeverity">Impact Level</label>
                    <select id="incidentSeverity">
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                        <option value="critical">Critical</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="incidentResolution">Resolution/Action Taken</label>
                    <textarea id="incidentResolution" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelIncident">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Event</button>
                </div>
            </form>
        </div>
    </div>

    <script>
    class PSPFExplorer {
        constructor() {
            // Initialize data structures
            this.projects = JSON.parse(localStorage.getItem('pspf_projects') || '[]');
            this.tasks = JSON.parse(localStorage.getItem('pspf_tasks') || '[]');
            this.risks = JSON.parse(localStorage.getItem('pspf_risks') || '[]');
            this.incidents = JSON.parse(localStorage.getItem('pspf_incidents') || '[]');
            this.compliance = JSON.parse(localStorage.getItem('pspf_compliance') || '{}');
            
            this.currentView = 'home';
            this.selectedDomain = null;
            this.editingProject = null;
            this.editingTask = null;
            this.editingRisk = null;
            this.editingIncident = null;
            
            this.init();
        }

        init() {
            this.loadDomainData();
            this.setupEventListeners();
            this.showWelcomeModalIfFirstTime();
            this.renderHome();
            this.updateDataStats();
        }

        loadDomainData() {
            this.domains = [
                {
                    id: 'governance',
                    title: 'Governance',
                    description: 'Strategic leadership, executive oversight, governance accountability and reporting',
                    requirements: ['gov-1', 'gov-2', 'gov-3', 'gov-4']
                },
                {
                    id: 'risk',
                    title: 'Risk Management',
                    description: 'Risk management, third-party evaluation, and mitigation strategies',
                    requirements: ['risk-1', 'risk-2', 'risk-3', 'risk-4']
                },
                {
                    id: 'information',
                    title: 'Information',
                    description: 'Information classification, need-to-know principle and handling procedures',
                    requirements: ['info-1', 'info-2', 'info-3', 'info-4', 'info-5']
                },
                {
                    id: 'technology',
                    title: 'Technology',
                    description: 'Technology strategy, system controls, emerging tech, and infrastructure',
                    requirements: ['tech-1', 'tech-2', 'tech-3', 'tech-4', 'tech-5']
                },
                {
                    id: 'personnel',
                    title: 'Personnel',
                    description: 'Personnel screening, pre-employment checks and ongoing monitoring',
                    requirements: ['pers-1', 'pers-2', 'pers-3', 'pers-4', 'pers-5']
                },
                {
                    id: 'physical',
                    title: 'Physical',
                    description: 'Physical zones, facility management, access controls and asset handling',
                    requirements: ['phys-1', 'phys-2', 'phys-3', 'phys-4', 'phys-5']
                }
            ];

            this.requirements = {
                'gov-1': { id: 'gov-1', domainId: 'governance', title: 'Executive Leadership', description: 'Appoint executive leadership for compliance oversight' },
                'gov-2': { id: 'gov-2', domainId: 'governance', title: 'Governance Framework', description: 'Establish comprehensive governance framework' },
                'gov-3': { id: 'gov-3', domainId: 'governance', title: 'Reporting Structure', description: 'Implement regular reporting and accountability measures' },
                'gov-4': { id: 'gov-4', domainId: 'governance', title: 'Compliance Monitoring', description: 'Monitor compliance effectiveness and improvement' },
                'risk-1': { id: 'risk-1', domainId: 'risk', title: 'Risk Assessment', description: 'Conduct comprehensive risk assessments' },
                'risk-2': { id: 'risk-2', domainId: 'risk', title: 'Risk Treatment', description: 'Implement risk treatment and mitigation strategies' },
                'risk-3': { id: 'risk-3', domainId: 'risk', title: 'Third Party Risk', description: 'Assess and manage third-party operational risks' },
                'risk-4': { id: 'risk-4', domainId: 'risk', title: 'Risk Monitoring', description: 'Continuously monitor and review risk landscape' },
                'info-1': { id: 'info-1', domainId: 'information', title: 'Information Classification', description: 'Classify information based on sensitivity' },
                'info-2': { id: 'info-2', domainId: 'information', title: 'Access Controls', description: 'Implement need-to-know access controls' },
                'info-3': { id: 'info-3', domainId: 'information', title: 'Handling Procedures', description: 'Establish secure information handling procedures' },
                'info-4': { id: 'info-4', domainId: 'information', title: 'Storage and Disposal', description: 'Secure information storage and disposal processes' },
                'info-5': { id: 'info-5', domainId: 'information', title: 'Sharing Protocols', description: 'Controlled information sharing protocols' },
                'tech-1': { id: 'tech-1', domainId: 'technology', title: 'Technology Strategy', description: 'Develop comprehensive technology strategy' },
                'tech-2': { id: 'tech-2', domainId: 'technology', title: 'System Controls', description: 'Implement essential system controls' },
                'tech-3': { id: 'tech-3', domainId: 'technology', title: 'Emerging Technologies', description: 'Manage emerging technology adoption' },
                'tech-4': { id: 'tech-4', domainId: 'technology', title: 'Infrastructure Management', description: 'Secure infrastructure management practices' },
                'tech-5': { id: 'tech-5', domainId: 'technology', title: 'Technology Governance', description: 'Technology governance and oversight' },
                'pers-1': { id: 'pers-1', domainId: 'personnel', title: 'Personnel Screening', description: 'Conduct comprehensive personnel screening' },
                'pers-2': { id: 'pers-2', domainId: 'personnel', title: 'Background Checks', description: 'Perform thorough background verification' },
                'pers-3': { id: 'pers-3', domainId: 'personnel', title: 'Ongoing Monitoring', description: 'Continuous personnel monitoring and review' },
                'pers-4': { id: 'pers-4', domainId: 'personnel', title: 'Training Programs', description: 'Implement comprehensive training programs' },
                'pers-5': { id: 'pers-5', domainId: 'personnel', title: 'Access Management', description: 'Personnel access management and review' },
                'phys-1': { id: 'phys-1', domainId: 'physical', title: 'Physical Zones', description: 'Establish appropriate physical zones' },
                'phys-2': { id: 'phys-2', domainId: 'physical', title: 'Facility Management', description: 'Comprehensive facility management practices' },
                'phys-3': { id: 'phys-3', domainId: 'physical', title: 'Access Controls', description: 'Physical access control systems' },
                'phys-4': { id: 'phys-4', domainId: 'physical', title: 'Asset Handling', description: 'Secure asset handling and tracking' },
                'phys-5': { id: 'phys-5', domainId: 'physical', title: 'Monitoring Systems', description: 'Physical monitoring and surveillance systems' }
            };
        }

        setupEventListeners() {
            // Navigation event listeners
            document.getElementById('homeBtn').addEventListener('click', () => {
                this.showView('home');
                this.updateNavButtons('homeBtn');
            });

            document.getElementById('searchBtn').addEventListener('click', () => {
                this.showView('search');
                this.updateNavButtons('searchBtn');
            });

            document.getElementById('progressBtn').addEventListener('click', () => {
                this.showView('progress');
                this.updateNavButtons('progressBtn');
                this.renderProgress();
            });

            document.getElementById('projectBtn').addEventListener('click', () => {
                this.showView('project');
                this.updateNavButtons('projectBtn');
            });

            document.getElementById('dataBtn').addEventListener('click', () => {
                this.showView('data');
                this.updateNavButtons('dataBtn');
                this.updateDataStats();
            });

            document.getElementById('helpBtn').addEventListener('click', () => {
                this.showView('help');
                this.updateNavButtons('helpBtn');
            });

            // Welcome modal
            const closeWelcomeBtn = document.getElementById('closeWelcome');
            if (closeWelcomeBtn) {
                closeWelcomeBtn.addEventListener('click', () => {
                    this.hideWelcomeModal();
                });
            }

            // Data management buttons
            const exportDataBtn = document.getElementById('exportDataBtn');
            if (exportDataBtn) {
                exportDataBtn.addEventListener('click', () => this.exportData());
            }

            const importDataBtn = document.getElementById('importDataBtn');
            const importFileInput = document.getElementById('importFileInput');
            if (importDataBtn && importFileInput) {
                importDataBtn.addEventListener('click', () => importFileInput.click());
                importFileInput.addEventListener('change', (e) => this.importData(e));
            }

            const clearDataBtn = document.getElementById('clearDataBtn');
            if (clearDataBtn) {
                clearDataBtn.addEventListener('click', () => this.clearAllData());
            }

            // Search functionality
            const searchInput = document.getElementById('searchInput');
            const searchSubmit = document.getElementById('searchSubmit');
            
            if (searchInput && searchSubmit) {
                const performSearch = () => {
                    const query = searchInput.value.toLowerCase().trim();
                    if (query) {
                        this.performSearch(query);
                    } else {
                        document.getElementById('searchResults').innerHTML = '<p>Please enter a search term.</p>';
                    }
                };

                searchSubmit.addEventListener('click', performSearch);
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        performSearch();
                    }
                });
            }

            // Project management
            const addProjectBtn = document.getElementById('addProjectBtn');
            if (addProjectBtn) {
                addProjectBtn.addEventListener('click', () => this.showProjectModal());
            }

            // Modal event listeners
            this.setupModalEventListeners();
        }

        setupModalEventListeners() {
            // Project modal
            const projectForm = document.getElementById('projectForm');
            const cancelProject = document.getElementById('cancelProject');
            
            if (projectForm) {
                projectForm.addEventListener('submit', (e) => this.handleProjectForm(e));
            }
            if (cancelProject) {
                cancelProject.addEventListener('click', () => this.hideModal('projectModal'));
            }

            // Task modal
            const taskForm = document.getElementById('taskForm');
            const cancelTask = document.getElementById('cancelTask');
            
            if (taskForm) {
                taskForm.addEventListener('submit', (e) => this.handleTaskForm(e));
            }
            if (cancelTask) {
                cancelTask.addEventListener('click', () => this.hideModal('taskModal'));
            }

            // Risk modal
            const riskForm = document.getElementById('riskForm');
            const cancelRisk = document.getElementById('cancelRisk');
            
            if (riskForm) {
                riskForm.addEventListener('submit', (e) => this.handleRiskForm(e));
            }
            if (cancelRisk) {
                cancelRisk.addEventListener('click', () => this.hideModal('riskModal'));
            }

            // Incident modal
            const incidentForm = document.getElementById('incidentForm');
            const cancelIncident = document.getElementById('cancelIncident');
            
            if (incidentForm) {
                incidentForm.addEventListener('submit', (e) => this.handleIncidentForm(e));
            }
            if (cancelIncident) {
                cancelIncident.addEventListener('click', () => this.hideModal('incidentModal'));
            }
        }

        showWelcomeModalIfFirstTime() {
            const hasSeenWelcome = localStorage.getItem('pspf_welcome_seen');
            if (!hasSeenWelcome) {
                this.showWelcomeModal();
            }
        }

        showWelcomeModal() {
            const modal = document.getElementById('welcomeModal');
            if (modal) {
                modal.style.display = 'block';
            }
        }

        hideWelcomeModal() {
            const modal = document.getElementById('welcomeModal');
            if (modal) {
                modal.style.display = 'none';
                localStorage.setItem('pspf_welcome_seen', 'true');
            }
        }

        showView(viewName) {
            // Hide all views
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active');
            });

            // Show selected view
            const targetView = document.getElementById(viewName + 'View');
            if (targetView) {
                targetView.classList.add('active');
                this.currentView = viewName;
            }

            // Special handling for project view
            if (viewName === 'project') {
                this.renderProjects();
            }
        }

        updateNavButtons(activeId) {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const activeBtn = document.getElementById(activeId);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
        }

        renderHome() {
            this.renderDomainsGrid();
            this.updateStats();
        }

        renderDomainsGrid() {
            const domainsGrid = document.getElementById('domainsGrid');
            if (!domainsGrid) return;

            domainsGrid.innerHTML = this.domains.map(domain => {
                const health = this.calculateDomainHealth(domain.id);
                const healthClass = health.status;
                
                return `
                    <div class="domain-card ${healthClass}" data-domain="${domain.id}">
                        <div class="domain-header">
                            <h3>${domain.title}</h3>
                            <div class="pulse-indicator">
                                <div class="pulse-dot ${healthClass}"></div>
                            </div>
                        </div>
                        <p class="domain-description">${domain.description}</p>
                        <div class="domain-stats">
                            <span class="stat">${health.met}/${health.total} requirements met</span>
                            <span class="health-text">${health.text}</span>
                        </div>
                        <button class="btn btn-outline domain-btn" onclick="window.pspfExplorer.showDomainRequirements('${domain.id}')">
                            View Requirements
                        </button>
                    </div>
                `;
            }).join('');
        }

        showDomainRequirements(domainId) {
            const domain = this.domains.find(d => d.id === domainId);
            if (!domain) return;

            this.selectedDomain = domainId;
            const requirementsSection = document.getElementById('requirementsSection');
            const selectedDomainTitle = document.getElementById('selectedDomainTitle');
            const selectedDomainDescription = document.getElementById('selectedDomainDescription');
            const requirementsGrid = document.getElementById('requirementsGrid');

            if (selectedDomainTitle) selectedDomainTitle.textContent = domain.title + ' Requirements';
            if (selectedDomainDescription) selectedDomainDescription.textContent = domain.description;

            if (requirementsGrid) {
                requirementsGrid.innerHTML = domain.requirements.map(reqId => {
                    const requirement = this.requirements[reqId];
                    const compliance = this.compliance[reqId] || { status: 'not-set', comment: '' };
                    
                    return `
                        <div class="requirement-card ${compliance.status}">
                            <h4>${requirement.title}</h4>
                            <p>${requirement.description}</p>
                            <div class="compliance-controls">
                                <select class="compliance-select" data-req="${reqId}" onchange="window.pspfExplorer.updateCompliance('${reqId}', this.value)">
                                    <option value="not-set" ${compliance.status === 'not-set' ? 'selected' : ''}>Not Set</option>
                                    <option value="yes" ${compliance.status === 'yes' ? 'selected' : ''}>Yes</option>
                                    <option value="no" ${compliance.status === 'no' ? 'selected' : ''}>No</option>
                                    <option value="partial" ${compliance.status === 'partial' ? 'selected' : ''}>Partial</option>
                                </select>
                                <textarea class="compliance-comment" data-req="${reqId}" placeholder="Add comments..." onblur="window.pspfExplorer.updateComplianceComment('${reqId}', this.value)">${compliance.comment}</textarea>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            if (requirementsSection) {
                requirementsSection.classList.remove('hidden');
            }
        }

        updateCompliance(reqId, status) {
            if (!this.compliance[reqId]) {
                this.compliance[reqId] = {};
            }
            this.compliance[reqId].status = status;
            this.saveData();
            this.renderDomainsGrid();
            this.updateStats();
        }

        updateComplianceComment(reqId, comment) {
            if (!this.compliance[reqId]) {
                this.compliance[reqId] = {};
            }
            this.compliance[reqId].comment = comment;
            this.saveData();
        }

        calculateDomainHealth(domainId) {
            const domain = this.domains.find(d => d.id === domainId);
            if (!domain) return { status: 'critical', met: 0, total: 0, text: 'Unknown' };

            const requirements = domain.requirements;
            let totalRequirements = requirements.length;
            let metRequirements = 0;
            let partialRequirements = 0;
            let unmetWithGoodExplanations = 0;

            requirements.forEach(reqId => {
                const compliance = this.compliance[reqId];
                if (compliance) {
                    if (compliance.status === 'yes') {
                        metRequirements++;
                    } else if (compliance.status === 'partial') {
                        partialRequirements++;
                    } else if (compliance.status === 'no' && compliance.comment && compliance.comment.trim().length > 10) {
                        unmetWithGoodExplanations++;
                    }
                }
            });

            if (metRequirements === totalRequirements) {
                return { status: 'healthy', met: metRequirements, total: totalRequirements, text: 'Excellent' };
            } else if (metRequirements + partialRequirements + unmetWithGoodExplanations >= totalRequirements * 0.8) {
                return { status: 'warning', met: metRequirements, total: totalRequirements, text: 'Good' };
            } else {
                return { status: 'critical', met: metRequirements, total: totalRequirements, text: 'Needs Attention' };
            }
        }

        updateStats() {
            let totalRequirements = 0;
            let metRequirements = 0;

            this.domains.forEach(domain => {
                domain.requirements.forEach(reqId => {
                    totalRequirements++;
                    const compliance = this.compliance[reqId];
                    if (compliance && compliance.status === 'yes') {
                        metRequirements++;
                    }
                });
            });

            const compliancePercentage = totalRequirements > 0 ? Math.round((metRequirements / totalRequirements) * 100) : 0;

            const totalProjects = this.projects.length;
            const totalTasks = this.tasks.length;
            const completedTasks = this.tasks.filter(t => t.status === 'completed').length;

            document.getElementById('totalProjects').textContent = totalProjects;
            document.getElementById('totalTasks').textContent = totalTasks;
            document.getElementById('completedTasks').textContent = completedTasks;
            document.getElementById('overallCompliance').textContent = compliancePercentage + '%';
        }

        renderProgress() {
            const progressGrid = document.getElementById('progressGrid');
            if (!progressGrid) return;

            progressGrid.innerHTML = this.domains.map((domain) => {
                const health = this.calculateDomainHealth(domain.id);
                const requirements = domain.requirements;
                const completedRequirements = requirements.filter(reqId => 
                    this.compliance[reqId] && this.compliance[reqId].status === 'yes'
                ).length;
                const percentage = Math.round((completedRequirements / requirements.length) * 100);

                return `
                    <div class="progress-card ${health.status}">
                        <div class="progress-header">
                            <h3>${domain.title}</h3>
                            <div class="pulse-dot ${health.status}"></div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%"></div>
                        </div>
                        <div class="progress-stats">
                            <span>${completedRequirements}/${requirements.length} completed</span>
                            <span>${percentage}%</span>
                        </div>
                        <p class="progress-status">${health.text}</p>
                        <button class="btn btn-outline btn-small" onclick="window.pspfExplorer.showDomainRequirements('${domain.id}'); window.pspfExplorer.showView('home'); window.pspfExplorer.updateNavButtons('homeBtn');">
                            Manage Compliance
                        </button>
                    </div>
                `;
            }).join('');
        }

        performSearch(query) {
            const results = [];
            const searchResults = document.getElementById('searchResults');

            // Search projects
            this.projects.forEach(project => {
                if (project.name.toLowerCase().includes(query) || 
                    project.description.toLowerCase().includes(query)) {
                    results.push({
                        type: 'Project',
                        title: project.name,
                        description: project.description,
                        id: project.id
                    });
                }
            });

            // Search tasks
            this.tasks.forEach(task => {
                if (task.name.toLowerCase().includes(query) || 
                    task.description.toLowerCase().includes(query)) {
                    results.push({
                        type: 'Task',
                        title: task.name,
                        description: task.description,
                        id: task.id
                    });
                }
            });

            // Search requirements
            Object.values(this.requirements).forEach(requirement => {
                if (requirement.title.toLowerCase().includes(query) || 
                    requirement.description.toLowerCase().includes(query)) {
                    const domain = this.domains.find(d => d.id === requirement.domainId);
                    results.push({
                        type: 'Requirement',
                        title: requirement.title,
                        description: requirement.description,
                        domain: domain ? domain.title : 'Unknown'
                    });
                }
            });

            if (results.length === 0) {
                searchResults.innerHTML = '<p>No results found for your search.</p>';
                return;
            }

            searchResults.innerHTML = `
                <h3>Search Results (${results.length})</h3>
                <div class="search-results-list">
                    ${results.map(result => `
                        <div class="search-result-item">
                            <span class="result-type">${result.type}</span>
                            <h4>${result.title}</h4>
                            <p>${result.description}</p>
                            ${result.domain ? `<span class="result-domain">Domain: ${result.domain}</span>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Project Management
        renderProjects() {
            const projectsList = document.getElementById('projectsList');
            if (!projectsList) return;

            if (this.projects.length === 0) {
                projectsList.innerHTML = `
                    <div class="empty-state">
                        <h3>No projects yet</h3>
                        <p>Create your first project to start tracking compliance work.</p>
                    </div>
                `;
                return;
            }

            projectsList.innerHTML = this.projects.map(project => `
                <div class="project-card">
                    <div class="project-header">
                        <h3>${project.name}</h3>
                        <span class="status-badge ${project.status}">${project.status}</span>
                    </div>
                    <p>${project.description}</p>
                    <div class="project-meta">
                        ${project.startDate ? `<span>Start: ${new Date(project.startDate).toLocaleDateString()}</span>` : ''}
                        ${project.endDate ? `<span>End: ${new Date(project.endDate).toLocaleDateString()}</span>` : ''}
                    </div>
                    <div class="project-actions">
                        <button class="btn btn-outline btn-small" onclick="window.pspfExplorer.showProjectModal('${project.id}')">Edit</button>
                        <button class="btn btn-danger btn-small" onclick="window.pspfExplorer.deleteProject('${project.id}')">Delete</button>
                        <button class="btn btn-primary btn-small" onclick="window.pspfExplorer.showProjectTasks('${project.id}')">View Tasks</button>
                    </div>
                </div>
            `).join('');
        }

        showProjectModal(projectId = null) {
            this.editingProject = projectId;
            const modal = document.getElementById('projectModal');
            const title = document.getElementById('projectModalTitle');
            const form = document.getElementById('projectForm');

            if (projectId) {
                const project = this.projects.find(p => p.id === projectId);
                if (project) {
                    title.textContent = 'Edit Project';
                    document.getElementById('projectName').value = project.name;
                    document.getElementById('projectDesc').value = project.description;
                    document.getElementById('projectStatusSelect').value = project.status;
                    document.getElementById('projectStartDate').value = project.startDate || '';
                    document.getElementById('projectEndDate').value = project.endDate || '';
                    document.getElementById('projectUrl').value = project.url || '';
                }
            } else {
                title.textContent = 'Add Project';
                form.reset();
            }

            modal.style.display = 'block';
        }

        handleProjectForm(e) {
            e.preventDefault();
            
            const projectData = {
                name: document.getElementById('projectName').value,
                description: document.getElementById('projectDesc').value,
                status: document.getElementById('projectStatusSelect').value,
                startDate: document.getElementById('projectStartDate').value,
                endDate: document.getElementById('projectEndDate').value,
                url: document.getElementById('projectUrl').value,
                createdAt: new Date().toISOString()
            };

            if (this.editingProject) {
                const index = this.projects.findIndex(p => p.id === this.editingProject);
                if (index !== -1) {
                    this.projects[index] = { ...this.projects[index], ...projectData };
                }
            } else {
                projectData.id = Date.now().toString();
                this.projects.push(projectData);
            }

            this.saveData();
            this.hideModal('projectModal');
            this.renderProjects();
            this.updateStats();
            this.updateDataStats();
        }

        deleteProject(projectId) {
            if (confirm('Are you sure you want to delete this project? This action cannot be undone.')) {
                this.projects = this.projects.filter(p => p.id !== projectId);
                // Also delete associated tasks
                this.tasks = this.tasks.filter(t => t.projectId !== projectId);
                this.saveData();
                this.renderProjects();
                this.updateStats();
                this.updateDataStats();
            }
        }

        showProjectTasks(projectId) {
            // This would show tasks for a specific project
            // For now, just show the help view as placeholder
            this.showView('help');
            this.updateNavButtons('helpBtn');
        }

        // Modal Management
        hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
            this.editingProject = null;
            this.editingTask = null;
            this.editingRisk = null;
            this.editingIncident = null;
        }

        // Placeholder methods for other CRUD operations
        handleTaskForm(e) {
            e.preventDefault();
            this.hideModal('taskModal');
        }

        handleRiskForm(e) {
            e.preventDefault();
            this.hideModal('riskModal');
        }

        handleIncidentForm(e) {
            e.preventDefault();
            this.hideModal('incidentModal');
        }

        // Data Management
        updateDataStats() {
            const projectCount = this.projects.length;
            const taskCount = this.tasks.length;
            const riskCount = this.risks.length;
            const incidentCount = this.incidents.length;
            const lastModified = localStorage.getItem('pspf_last_modified');

            document.getElementById('dataProjectCount').textContent = projectCount;
            document.getElementById('dataTaskCount').textContent = taskCount;
            document.getElementById('dataRiskCount').textContent = riskCount;
            document.getElementById('dataIncidentCount').textContent = incidentCount;
            document.getElementById('dataLastModified').textContent = 
                lastModified ? new Date(lastModified).toLocaleDateString() : 'Never';
        }

        exportData() {
            try {
                const exportData = {
                    version: '1.0',
                    timestamp: new Date().toISOString(),
                    data: {
                        projects: this.projects,
                        tasks: this.tasks,
                        risks: this.risks,
                        incidents: this.incidents,
                        compliance: this.compliance
                    }
                };

                const blob = new Blob([JSON.stringify(exportData, null, 2)], {
                    type: 'application/json'
                });

                const url = URL.createObjectURL(blob);
                const downloadLink = document.createElement('a');
                downloadLink.href = url;
                downloadLink.download = `pspf-explorer-backup-${new Date().toISOString().split('T')[0]}.json`;
                
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                alert('Data exported successfully!');
                
            } catch (error) {
                console.error('Export failed:', error);
                alert('Export failed. Please try again.');
            }
        }

        importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importData = JSON.parse(e.target.result);
                    
                    if (!importData.data || !importData.version) {
                        throw new Error('Invalid backup file format');
                    }

                    if (!confirm('This will replace all current data with imported data. Continue?')) {
                        return;
                    }

                    this.projects = importData.data.projects || [];
                    this.tasks = importData.data.tasks || [];
                    this.risks = importData.data.risks || [];
                    this.incidents = importData.data.incidents || [];
                    this.compliance = importData.data.compliance || {};

                    this.saveData();
                    this.updateDataStats();
                    this.renderHome();

                    alert('Data imported successfully!');
                    
                } catch (error) {
                    console.error('Import failed:', error);
                    alert('Import failed. Please check the file format and try again.');
                }
            };

            reader.readAsText(file);
            event.target.value = '';
        }

        clearAllData() {
            if (!confirm('This will permanently delete ALL your data. This action cannot be undone!\n\nAre you sure?')) {
                return;
            }

            try {
                this.projects = [];
                this.tasks = [];
                this.risks = [];
                this.incidents = [];
                this.compliance = {};

                localStorage.removeItem('pspf_projects');
                localStorage.removeItem('pspf_tasks');
                localStorage.removeItem('pspf_risks');
                localStorage.removeItem('pspf_incidents');
                localStorage.removeItem('pspf_compliance');
                localStorage.removeItem('pspf_last_modified');

                this.updateDataStats();
                this.renderHome();

                alert('All data has been cleared successfully.');
                
            } catch (error) {
                console.error('Clear data failed:', error);
                alert('Failed to clear data. Please try again.');
            }
        }

        saveData() {
            localStorage.setItem('pspf_projects', JSON.stringify(this.projects));
            localStorage.setItem('pspf_tasks', JSON.stringify(this.tasks));
            localStorage.setItem('pspf_risks', JSON.stringify(this.risks));
            localStorage.setItem('pspf_incidents', JSON.stringify(this.incidents));
            localStorage.setItem('pspf_compliance', JSON.stringify(this.compliance));
            localStorage.setItem('pspf_last_modified', new Date().toISOString());
        }
    }

    // Initialize application when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
        window.pspfExplorer = new PSPFExplorer();
    });
    </script>
</body>
</html>